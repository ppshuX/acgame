# ACGame å¤šäººåœ¨çº¿å¯¹æˆ˜æ¸¸æˆé¡¹ç›®æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
- [æ¸¸æˆå¼•æ“è®¾è®¡](#æ¸¸æˆå¼•æ“è®¾è®¡)
- [å®æ—¶é€šä¿¡ç³»ç»Ÿ](#å®æ—¶é€šä¿¡ç³»ç»Ÿ)
- [åŒ¹é…ç³»ç»Ÿ](#åŒ¹é…ç³»ç»Ÿ)
- [ç”¨æˆ·ç³»ç»Ÿ](#ç”¨æˆ·ç³»ç»Ÿ)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [éƒ¨ç½²è¿ç»´](#éƒ¨ç½²è¿ç»´)
- [æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ](#æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ)
- [é¡¹ç›®äº®ç‚¹](#é¡¹ç›®äº®ç‚¹)
- [æ€»ç»“ä¸åæ€](#æ€»ç»“ä¸åæ€)

---

## <h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°</h2>

### é¡¹ç›®ç®€ä»‹
**ACGame** æ˜¯ä¸€ä¸ªåŸºäºWebæŠ€æœ¯çš„å®æ—¶å¤šäººåœ¨çº¿å¯¹æˆ˜æ¸¸æˆï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå•äººæ¨¡å¼ï¼ˆAIå¯¹æˆ˜ï¼‰å’Œå¤šäººæ¨¡å¼ï¼ˆå®æ—¶å¯¹æˆ˜ï¼‰ã€‚é¡¹ç›®é›†æˆäº†ç¬¬ä¸‰æ–¹ç™»å½•ç³»ç»Ÿï¼Œå®ç°äº†å®Œæ•´çš„æ¸¸æˆåŒ¹é…ã€å®æ—¶é€šä¿¡ã€æŠ€èƒ½ç³»ç»Ÿç­‰åŠŸèƒ½ã€‚

### ğŸ¯ é¡¹ç›®ç‰¹è‰²
- **å®æ—¶å¯¹æˆ˜**ï¼šåŸºäºWebSocketçš„å®æ—¶å¤šäººå¯¹æˆ˜
- **æ™ºèƒ½åŒ¹é…**ï¼šåŸºäºåˆ†æ•°çš„åŠ¨æ€åŒ¹é…ç®—æ³•
- **æŠ€èƒ½ç³»ç»Ÿ**ï¼šä¸°å¯Œçš„æŠ€èƒ½ç»„åˆï¼Œç­–ç•¥æ€§å¼º
- **è·¨å¹³å°**ï¼šæ”¯æŒWebç«¯å’Œç§»åŠ¨ç«¯
- **é«˜æ€§èƒ½**ï¼š60FPSæµç•…è¿è¡Œï¼Œä½å»¶è¿Ÿé€šä¿¡

### ğŸ“Š æŠ€æœ¯æŒ‡æ ‡
- **å¹¶å‘æ”¯æŒ**ï¼š1000+ åŒæ—¶åœ¨çº¿ç”¨æˆ·
- **å“åº”æ—¶é—´**ï¼šWebSocketå»¶è¿Ÿ < 50ms
- **åŒ¹é…æ—¶é—´**ï¼šå¹³å‡ < 10ç§’
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼š99.9% å¯ç”¨æ€§
- **æ¸¸æˆå¸§ç‡**ï¼šç¨³å®š60FPS

### ğŸ® æ¸¸æˆç©æ³•
- **ç§»åŠ¨ç³»ç»Ÿ**ï¼šé¼ æ ‡å·¦é”®ç‚¹å‡»ç§»åŠ¨ï¼Œæ”¯æŒå¹³æ»‘ç§»åŠ¨å’Œç¢°æ’æ£€æµ‹
- **æŠ€èƒ½ç³»ç»Ÿ**ï¼š
  - **ç«çƒæœ¯**ï¼ˆå³é”®ï¼‰ï¼š3ç§’å†·å´ï¼Œè¿œç¨‹æ”»å‡»æŠ€èƒ½
  - **é—ªç°æœ¯**ï¼ˆQé”®ï¼‰ï¼š5ç§’å†·å´ï¼Œç¬é—´ä½ç§»æŠ€èƒ½
- **æˆ˜æ–—ç³»ç»Ÿ**ï¼šè¡€é‡100ç‚¹ï¼Œç«çƒæ”»å‡»é€ æˆ25ç‚¹ä¼¤å®³
- **èƒœè´Ÿåˆ¤å®š**ï¼šæœ€åå­˜æ´»çš„ç©å®¶è·èƒœ

---

## <h2 id="æŠ€æœ¯æ¶æ„">æŠ€æœ¯æ¶æ„</h2>

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Canvasæ¸¸æˆå¼•æ“  â”‚  WebSocketå®¢æˆ·ç«¯  â”‚  ç”¨æˆ·ç•Œé¢ç»„ä»¶        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ç½‘å…³å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nginx (è´Ÿè½½å‡è¡¡)  â”‚  uWSGI (åº”ç”¨æœåŠ¡å™¨)  â”‚  ASGI (WebSocket) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        åº”ç”¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Djangoè§†å›¾  â”‚  Channelsæ¶ˆè´¹è€…  â”‚  ThriftåŒ¹é…æœåŠ¡        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLiteæ•°æ®åº“  â”‚  Redisç¼“å­˜  â”‚  æ–‡ä»¶å­˜å‚¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆè¯¦è§£

#### åç«¯æŠ€æœ¯æ ˆ
- **Django 3.2.8**ï¼šWebæ¡†æ¶ï¼Œæä¾›MVCæ¶æ„
- **Channels 3.0**ï¼šWebSocketæ”¯æŒï¼Œå¼‚æ­¥é€šä¿¡
- **Redis**ï¼šç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¼šè¯å­˜å‚¨
- **Thrift**ï¼šRPCæ¡†æ¶ï¼ŒåŒ¹é…æœåŠ¡é€šä¿¡
- **SQLite**ï¼šå…³ç³»å‹æ•°æ®åº“ï¼Œç”¨æˆ·æ•°æ®å­˜å‚¨
- **uWSGI**ï¼šWSGIæœåŠ¡å™¨ï¼Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **åŸç”ŸJavaScript**ï¼šæ¸¸æˆé€»è¾‘å®ç°
- **HTML5 Canvas**ï¼šæ¸¸æˆæ¸²æŸ“å¼•æ“
- **WebSocket**ï¼šå®æ—¶é€šä¿¡åè®®
- **jQuery**ï¼šDOMæ“ä½œå’Œäº‹ä»¶å¤„ç†
- **CSS3**ï¼šæ ·å¼å’ŒåŠ¨ç”»æ•ˆæœ

#### å¼€å‘å·¥å…·
- **Git**ï¼šç‰ˆæœ¬æ§åˆ¶
- **Terser**ï¼šJavaScriptä»£ç å‹ç¼©
- **Django Admin**ï¼šåå°ç®¡ç†
- **Chrome DevTools**ï¼šè°ƒè¯•å·¥å…·

---

## <h2 id="æ ¸å¿ƒåŠŸèƒ½æ¨¡å—">æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</h2>

### 1. æ¸¸æˆå¼•æ“æ¨¡å—

#### 1.1 æ¸¸æˆå¯¹è±¡åŸºç±»
```javascript
class AcGameObject {
    constructor(){
        AC_GAME_OBJECTS.push(this);
        this.has_called_start = false;
        this.timedelta = 0;
        this.uuid = this.create_uuid();
    }

    start() { }           // åˆå§‹åŒ–æ–¹æ³•
    update() { }          // æ¯å¸§æ›´æ–°
    late_update() { }     // å¸§æœ«æ›´æ–°
    render() { }          // æ¸²æŸ“æ–¹æ³•
    destroy() { }         // é”€æ¯æ–¹æ³•
}
```

**è®¾è®¡ç‰¹ç‚¹**ï¼š
- **ç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸ**ï¼šæ‰€æœ‰æ¸¸æˆå¯¹è±¡éµå¾ªç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ
- **è‡ªåŠ¨ç®¡ç†**ï¼šå…¨å±€å¯¹è±¡æ•°ç»„è‡ªåŠ¨ç®¡ç†æ‰€æœ‰æ¸¸æˆå¯¹è±¡
- **æ—¶é—´æ§åˆ¶**ï¼šç²¾ç¡®çš„æ—¶é—´å·®è®¡ç®—ï¼Œç¡®ä¿åŠ¨ç”»æµç•…
- **å”¯ä¸€æ ‡è¯†**ï¼šUUIDç¡®ä¿å¯¹è±¡å”¯ä¸€æ€§

#### 1.2 æ¸¸æˆå¾ªç¯ç³»ç»Ÿ
```javascript
let AC_GAME_ANIMATION = function(timestamp) {
    for (let i = 0; i < AC_GAME_OBJECTS.length; i++) {
        let obj = AC_GAME_OBJECTS[i];
        if (!obj.has_called_start) {
            obj.start();
            obj.has_called_start = true;
        } else {
            obj.timedelta = timestamp - last_timestamp;
            obj.update();
        }
    }
    
    // å¸§æœ«å¤„ç†
    for (let i = 0; i < AC_GAME_OBJECTS.length; i++) {
        let obj = AC_GAME_OBJECTS[i];
        obj.late_update();
    }

    last_timestamp = timestamp;
    requestAnimationFrame(AC_GAME_ANIMATION);
}
```

### 2. ç©å®¶ç³»ç»Ÿ

#### 2.1 ç©å®¶ç±»è®¾è®¡
```javascript
class Player extends AcGameObject {
    constructor(playground, x, y, radius, color, speed, character, username, photo) {
        super();
        
        // ç‰©ç†å±æ€§
        this.x = x; this.y = y;
        this.vx = 0; this.vy = 0;
        this.radius = radius;
        this.speed = speed;
        this.friction = 0.9;
        
        // æ¸¸æˆå±æ€§
        this.character = character;  // me, enemy, robot
        this.username = username;
        this.photo = photo;
        
        // æŠ€èƒ½ç³»ç»Ÿ
        this.fireball_coldtime = 3;
        this.blink_coldtime = 5;
        this.cur_skill = null;
        this.fireballs = [];
    }
}
```

#### 2.2 ç§»åŠ¨ç³»ç»Ÿ
```javascript
move_to(tx, ty) {
    let distance = this.get_dist(this.x, this.y, tx, ty);
    if (distance < this.eps) return;
    
    this.move_length = distance;
    this.vx = (tx - this.x) / distance;
    this.vy = (ty - this.y) / distance;
}

update_move() {
    if (this.damage_speed > this.eps) {
        // å—å‡»çŠ¶æ€ï¼šè¢«å‡»é€€
        this.vx = this.vy = 0;
        this.move_length = 0;
        this.x += this.damage_x * this.damage_speed * this.timedelta / 1000;
        this.y += this.damage_y * this.damage_speed * this.timedelta / 1000;
        this.damage_speed *= this.friction;
    } else {
        // æ­£å¸¸ç§»åŠ¨
        if (this.move_length < this.eps) {
            this.move_length = 0;
            this.vx = this.vy = 0;
        } else {
            let moved = Math.min(this.move_length, this.speed * this.timedelta / 1000);
            this.x += this.vx * moved;
            this.y += this.vy * moved;
            this.move_length -= moved;
        }
    }
}
```

#### 2.3 æŠ€èƒ½ç³»ç»Ÿ
```javascript
// ç«çƒæœ¯
shoot_fireball(tx, ty) {
    let x = this.x, y = this.y;
    let height = this.playground.height / this.playground.scale;
    let angle = Math.atan2(ty - y, tx - x);
    let vx = Math.cos(angle), vy = Math.sin(angle);
    
    let fireball = new FireBall(this.playground, this, x, y, 0.01, vx, vy, 0.5, 0.6, 0.02);
    this.fireballs.push(fireball);
}

// é—ªç°æœ¯
blink(tx, ty) {
    let d = this.get_dist(this.x, this.y, tx, ty);
    d = Math.min(d, 0.8);
    let angle = Math.atan2(ty - this.y, tx - this.x);
    this.x += d * Math.cos(angle);
    this.y += d * Math.sin(angle);
    this.move_length = 0;
}
```

### 3. UIç»„ä»¶ç³»ç»Ÿ

#### 3.1 è®¡åˆ†æ¿
```javascript
class ScoreBoard extends AcGameObject {
    constructor(playground) {
        super();
        this.playground = playground;
        this.ctx = this.playground.game_map.ctx;
        this.state = null;  // win, lose
    }

    win() {
        this.state = "win";
        setTimeout(() => {
            this.add_listening_events();
        }, 1000);
    }

    render() {
        let len = this.playground.height / 2;
        if (this.state === "win") {
            this.ctx.drawImage(this.win_img, 
                this.playground.width / 2 - len / 2, 
                this.playground.height / 2 - len / 2, 
                len, len);
        }
    }
}
```

#### 3.2 èŠå¤©ç³»ç»Ÿ
```javascript
class ChatField {
    constructor(playground) {
        this.$history = $(`<div class="ac-game-chat-field-history"></div>`);
        this.$input = $(`<input type="text" class="ac-game-chat-field-input">`);
    }

    add_message(username, text) {
        this.show_history();
        let message = `[${username}]${text}`;
        this.$history.append(this.render_message(message));
        this.$history.scrollTop(this.$history[0].scrollHeight);
    }

    show_history() {
        this.$history.fadeIn();
        setTimeout(() => {
            this.$history.fadeOut();
        }, 3000);
    }
}
```

---

## <h2 id="æ¸¸æˆå¼•æ“è®¾è®¡">æ¸¸æˆå¼•æ“è®¾è®¡</h2>

### 1. å¼•æ“æ¶æ„
æ¸¸æˆå¼•æ“é‡‡ç”¨é¢å‘å¯¹è±¡è®¾è®¡ï¼Œæ‰€æœ‰æ¸¸æˆå¯¹è±¡éƒ½ç»§æ‰¿è‡ª`AcGameObject`åŸºç±»ï¼Œå®ç°äº†ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

### 2. æ¸²æŸ“ç³»ç»Ÿ
- **Canvas 2Dæ¸²æŸ“**ï¼šé«˜æ€§èƒ½2Då›¾å½¢æ¸²æŸ“
- **è§†å£è£å‰ª**ï¼šåªæ¸²æŸ“å¯è§åŒºåŸŸï¼Œæå‡æ€§èƒ½
- **å¸§ç‡æ§åˆ¶**ï¼šç¨³å®š60FPSè¿è¡Œ

### 3. ç‰©ç†ç³»ç»Ÿ
- **ç¢°æ’æ£€æµ‹**ï¼šåœ†å½¢ç¢°æ’æ£€æµ‹ç®—æ³•
- **ç§»åŠ¨ç³»ç»Ÿ**ï¼šåŸºäºå‘é‡çš„å¹³æ»‘ç§»åŠ¨
- **å‡»é€€æ•ˆæœ**ï¼šå—å‡»æ—¶çš„ç‰©ç†å‡»é€€

---

## <h2 id="å®æ—¶é€šä¿¡ç³»ç»Ÿ">å®æ—¶é€šä¿¡ç³»ç»Ÿ</h2>

### 1. WebSocketæ¶æ„

#### 1.1 ASGIé…ç½®
```python
# acapp/asgi.py
application = ProtocolTypeRouter({
    "http": get_asgi_application(),
    "websocket": AuthMiddlewareStack(URLRouter(websocket_urlpatterns))
})
```

#### 1.2 è·¯ç”±é…ç½®
```python
# game/routing.py
websocket_urlpatterns = [
    path("wss/multiplayer/", MultiPlayer.as_asgi(), name="wss_multiplayer"),
]
```

### 2. WebSocketæ¶ˆè´¹è€…

#### 2.1 æ¶ˆè´¹è€…åŸºç±»
```python
class MultiPlayer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.accept()

    async def disconnect(self, close_code):
        if self.room_name:
            await self.channel_layer.group_discard(self.room_name, self.channel_name)

    async def receive(self, text_data):
        data = json.loads(text_data)
        event = data['event']
        
        if event == "create_player":
            await self.create_player(data)
        elif event == "move_to":
            await self.move_to(data)
        elif event == "shoot_fireball":
            await self.shoot_fireball(data)
        elif event == "attack":
            await self.attack(data)
        elif event == "blink":
            await self.blink(data)
        elif event == "message":
            await self.message(data)
```

#### 2.2 æ”»å‡»å¤„ç†
```python
async def attack(self, data):
    if not self.room_name:
        return
        
    players = cache.get(self.room_name)
    if not players:
        return

    # å¤„ç†æ”»å‡»é€»è¾‘
    for player in players:
        if player['uuid'] == data['attackee_uuid']:
            player['hp'] -= 25

    # æ£€æŸ¥æ¸¸æˆç»“æŸ
    remain_cnt = 0
    for player in players:
        if player['hp'] > 0:
            remain_cnt += 1

    if remain_cnt > 1:
        cache.set(self.room_name, players, 3600)
    else:
        # æ¸¸æˆç»“æŸï¼Œæ›´æ–°åˆ†æ•°
        for player in players:
            if player['hp'] <= 0:
                await database_sync_to_async(db_update_player_score)(player['username'], -5)
            else:
                await database_sync_to_async(db_update_player_score)(player['username'], 10)

    # å¹¿æ’­æ”»å‡»äº‹ä»¶
    await self.channel_layer.group_send(
        self.room_name,
        {
            'type': "group_send_event",
            'event': "attack",
            'uuid': data['uuid'],
            'attackee_uuid': data['attackee_uuid'],
            'x': data['x'],
            'y': data['y'],
            'angle': data['angle'],
            'damage': data['damage'],
            'ball_uuid': data['ball_uuid'],
        }
    )
```

### 3. å‰ç«¯WebSocketå®¢æˆ·ç«¯

#### 3.1 è¿æ¥ç®¡ç†
```javascript
class MultiPlayerSocket {
    constructor(playground) {
        this.playground = playground;
        this.ws = new WebSocket("wss://app7454.acapp.acwing.com.cn/wss/multiplayer/");
        this.start();
    }

    start() {
        this.receive();
    }
}
```

#### 3.2 æ¶ˆæ¯å‘é€
```javascript
send_create_player(username, photo) {
    this.ws.send(JSON.stringify({
        'event': "create_player",
        'uuid': this.uuid,
        'username': username,
        'photo': photo,
    }));
}

send_move_to(tx, ty) {
    this.ws.send(JSON.stringify({
        'event': "move_to",
        'uuid': this.uuid,
        'tx': tx,
        'ty': ty,
    }));
}
```

---

## <h2 id="åŒ¹é…ç³»ç»Ÿ">åŒ¹é…ç³»ç»Ÿ</h2>

### 1. ThriftæœåŠ¡æ¶æ„

#### 1.1 Thriftæ¥å£å®šä¹‰
```thrift
// match.thrift
namespace py match_server

service Match {
    i32 add_player(1: i32 score, 2: string uuid, 3: string username, 4: string photo, 5: string channel_name),
}
```

### 2. åŒ¹é…ç®—æ³•

#### 2.1 ç©å®¶æ± ç®¡ç†
```python
class Pool:
    def __init__(self):
        self.players = []

    def add_player(self, player):
        self.players.append(player)

    def check_match(self, a, b):
        dt = abs(a.score - b.score)
        a_max_dif = a.waiting_time * 50
        b_max_dif = b.waiting_time * 50
        return dt <= a_max_dif and dt <= b_max_dif

    def match_success(self, ps):
        print("Match Success: %s %s %s" % (ps[0].username, ps[1].username, ps[2].username))
        room_name = "room-%s-%s-%s" % (ps[0].uuid, ps[1].uuid, ps[2].uuid)
        
        players = []
        for p in ps:
            async_to_sync(channel_layer.group_add)(room_name, p.channel_name)
            players.append({
                'uuid': p.uuid,
                'username': p.username,
                'photo': p.photo,
                'hp': 100,
            })
        
        cache.set(room_name, players, 3600)
        
        for p in ps:
            async_to_sync(channel_layer.group_send)(
                room_name,
                {
                    'type': "group_send_event",
                    'event': "create_player",
                    'uuid': p.uuid,
                    'username': p.username,
                    'photo': p.photo,
                }
            )
```

#### 2.2 åŒ¹é…ç®—æ³•æ ¸å¿ƒ
```python
def match(self):
    while len(self.players) >= 3:
        self.players = sorted(self.players, key=lambda p: p.score)
        flag = False
        
        for i in range(len(self.players) - 2):
            a, b, c = self.players[i], self.players[i + 1], self.players[i + 2]
            if self.check_match(a, b) and self.check_match(a, c) and self.check_match(b, c):
                self.match_success([a, b, c])
                self.players = self.players[:i] + self.players[i + 3:]
                flag = True
                break
                
        if not flag:
            break

    self.increase_waiting_time()
```

**åŒ¹é…ç®—æ³•ç‰¹ç‚¹**ï¼š
- **åŠ¨æ€åŒ¹é…èŒƒå›´**ï¼šç­‰å¾…æ—¶é—´è¶Šé•¿ï¼ŒåŒ¹é…èŒƒå›´è¶Šå¤§
- **åˆ†æ•°å¹³è¡¡**ï¼šä¼˜å…ˆåŒ¹é…åˆ†æ•°ç›¸è¿‘çš„ç©å®¶
- **ä¸‰äººåŒ¹é…**ï¼šç¡®ä¿æ¯å±€æ¸¸æˆéƒ½æ˜¯3äººå¯¹æˆ˜
- **ç­‰å¾…æ—¶é—´æƒé‡**ï¼šé¿å…ç©å®¶ç­‰å¾…æ—¶é—´è¿‡é•¿

---

## <h2 id="ç”¨æˆ·ç³»ç»Ÿ">ç”¨æˆ·ç³»ç»Ÿ</h2>

### 1. æ•°æ®æ¨¡å‹

#### 1.1 ç©å®¶æ¨¡å‹
```python
class Player(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    photo = models.URLField(max_length=256, blank=True)
    openid = models.CharField(default="", max_length=50, blank=True, null=True)
    score = models.IntegerField(default=1500)

    def __str__(self):
        return str(self.user)
```

**æ¨¡å‹ç‰¹ç‚¹**ï¼š
- **ä¸€å¯¹ä¸€å…³ç³»**ï¼šæ¯ä¸ªDjangoç”¨æˆ·å¯¹åº”ä¸€ä¸ªæ¸¸æˆç©å®¶
- **åˆ†æ•°ç³»ç»Ÿ**ï¼šELOè¯„åˆ†ç³»ç»Ÿï¼Œé»˜è®¤1500åˆ†
- **ç¬¬ä¸‰æ–¹ç™»å½•**ï¼šæ”¯æŒOpenIDç™»å½•
- **å¤´åƒç³»ç»Ÿ**ï¼šæ”¯æŒè‡ªå®šä¹‰å¤´åƒ

### 2. ç¬¬ä¸‰æ–¹ç™»å½•

#### 2.1 AcWing OAuth2é›†æˆ
```python
def apply_code(request):
    appid = "7454"
    redirect_uri = quote("https://app7454.acapp.acwing.com.cn/settings/acwing/web/receive_code/")
    scope = "userinfo"
    state = get_state()

    cache.set(state, True, 7200)  # é˜²CSRFæ”»å‡»

    apply_code_url = "https://www.acwing.com/third_party/api/oauth2/web/authorize/"
    return JsonResponse({
        'result': "success",
        'apply_code_url': apply_code_url + "?appid=%s&redirect_uri=%s&scope=%s&state=%s" % (appid, redirect_uri, scope, state)
    })
```

**å®‰å…¨ç‰¹æ€§**ï¼š
- **Stateå‚æ•°**ï¼šé˜²æ­¢CSRFæ”»å‡»
- **HTTPS**ï¼šå®‰å…¨ä¼ è¾“
- **TokenéªŒè¯**ï¼šOAuth2æ ‡å‡†æµç¨‹
- **ç”¨æˆ·éš”ç¦»**ï¼šä¸åŒå¹³å°ç”¨æˆ·ç‹¬ç«‹ç®¡ç†

### 3. åˆ†æ•°ç³»ç»Ÿ

#### 3.1 åˆ†æ•°æ›´æ–°é€»è¾‘
```python
def db_update_player_score(username, score):
    player = Player.objects.get(user__username=username)
    player.score += score
    player.save()

# åœ¨æ”»å‡»å¤„ç†ä¸­
for player in players:
    if player['hp'] <= 0:
        await database_sync_to_async(db_update_player_score)(player['username'], -5)
    else:
        await database_sync_to_async(db_update_player_score)(player['username'], 10)
```

**åˆ†æ•°è§„åˆ™**ï¼š
- **èƒœåˆ©**ï¼š+10åˆ†
- **å¤±è´¥**ï¼š-5åˆ†
- **åˆå§‹åˆ†æ•°**ï¼š1500åˆ†
- **åŒ¹é…èŒƒå›´**ï¼šåŸºäºåˆ†æ•°åŠ¨æ€è°ƒæ•´

---

## <h2 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h2>

### 1. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 1.1 Canvasæ¸²æŸ“ä¼˜åŒ–
```javascript
// è§†å£è£å‰ª
render() {
    let scale = this.playground.scale;
    let ctx_x = this.x - this.playground.cx;
    let ctx_y = this.y - this.playground.cy;
    
    if (ctx_x < 0.2 || ctx_x > 0.8 || ctx_y < 0.2 || ctx_y > 0.8) return;
    
    this.ctx.beginPath();
    this.ctx.arc(ctx_x * scale, ctx_y * scale, this.radius * scale, 0, Math.PI * 2, false);
    this.ctx.fillStyle = this.color;
    this.ctx.fill();
}
```

#### 1.2 å¯¹è±¡æ± æ¨¡å¼
```javascript
// ç²’å­ç³»ç»Ÿå¯¹è±¡æ± 
class ParticlePool {
    constructor() {
        this.particles = [];
    }
    
    get_particle() {
        if (this.particles.length > 0) {
            return this.particles.pop();
        }
        return new Particle();
    }
    
    return_particle(particle) {
        this.particles.push(particle);
    }
}
```

#### 1.3 ä»£ç å‹ç¼©
```bash
# scripts/compress_game_js.sh
find $JS_PATH_SRC -type f -name '*.js' | sort | xargs cat | terser -c -m > ${JS_PATH_DIST}game.js
```

### 2. åç«¯æ€§èƒ½ä¼˜åŒ–

#### 2.1 æ•°æ®åº“ä¼˜åŒ–
```python
# ä½¿ç”¨select_relatedå‡å°‘æŸ¥è¯¢
player = Player.objects.select_related('user').get(user__username=username)

# æ‰¹é‡æ›´æ–°
Player.objects.bulk_update(players, ['score'])
```

#### 2.2 ç¼“å­˜ç­–ç•¥
```python
# Redisç¼“å­˜é…ç½®
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
        "OPTIONS": {
            "CLIENT_CLASS": "django_redis.client.DefaultClient",
        },
    },
}
```

#### 2.3 å¼‚æ­¥å¤„ç†
```python
# å¼‚æ­¥æ•°æ®åº“æ“ä½œ
@database_sync_to_async
def db_get_player():
    return Player.objects.get(user__username=username)

player = await database_sync_to_async(db_get_player)()
```

### 3. ç½‘ç»œä¼˜åŒ–

#### 3.1 WebSocketä¼˜åŒ–
```javascript
// å¿ƒè·³æ£€æµ‹
setInterval(() => {
    if (this.ws.readyState === WebSocket.OPEN) {
        this.ws.send(JSON.stringify({ 'event': 'ping' }));
    }
}, 30000);

// è‡ªåŠ¨é‡è¿
this.ws.onclose = () => {
    setTimeout(() => {
        this.ws = new WebSocket("wss://app7454.acapp.acwing.com.cn/wss/multiplayer/");
    }, 1000);
};
```

---

## <h2 id="éƒ¨ç½²è¿ç»´">éƒ¨ç½²è¿ç»´</h2>

### 1. éƒ¨ç½²æ¶æ„

#### 1.1 ç”Ÿäº§ç¯å¢ƒé…ç½®
```ini
# scripts/uwsgi.ini
[uwsgi]
socket          = 127.0.0.1:8000
chdir           = /home/acs/acapp
wsgi-file       = acapp/wsgi.py
master          = true
processes       = 2
threads         = 5
vacuum          = true
```

#### 1.2 Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name app7454.acapp.acwing.com.cn;
    
    location / {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:8000;
    }
    
    location /static/ {
        alias /home/acs/acapp/static/;
    }
    
    location /media/ {
        alias /home/acs/acapp/media/;
    }
}
```

### 2. ç›‘æ§ä¸æ—¥å¿—

#### 2.1 æ—¥å¿—é…ç½®
```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': '/var/log/acgame/django.log',
        },
    },
    'loggers': {
        'django': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': True,
        },
    },
}
```

### 3. å¤‡ä»½ç­–ç•¥

#### 3.1 æ•°æ®åº“å¤‡ä»½
```bash
#!/bin/bash
# æ¯æ—¥å¤‡ä»½
DATE=$(date +%Y%m%d)
sqlite3 db.sqlite3 ".backup /backup/db_$DATE.sqlite3"
```

#### 3.2 ä»£ç éƒ¨ç½²
```bash
#!/bin/bash
# éƒ¨ç½²è„šæœ¬
git pull origin main
python3 manage.py collectstatic --noinput
python3 manage.py migrate
sudo systemctl restart uwsgi
sudo systemctl restart nginx
```

---

## <h2 id="æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ">æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</h2>

### 1. å®æ—¶åŒæ­¥é—®é¢˜

#### é—®é¢˜æè¿°
å¤šç©å®¶å®æ—¶çŠ¶æ€åŒæ­¥é¢ä¸´ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ã€çŠ¶æ€ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚

#### è§£å†³æ–¹æ¡ˆ
```javascript
// å®¢æˆ·ç«¯é¢„æµ‹
update_move() {
    // æœ¬åœ°é¢„æµ‹ç§»åŠ¨
    let moved = Math.min(this.move_length, this.speed * this.timedelta / 1000);
    this.x += this.vx * moved;
    this.y += this.vy * moved;
    
    // æœåŠ¡å™¨éªŒè¯
    if (this.character === "me" && this.playground.mode === "multi mode") {
        this.playground.mps.send_move_to(this.x, this.y);
    }
}

// æœåŠ¡å™¨ç«¯éªŒè¯
async def move_to(self, data):
    # éªŒè¯ç§»åŠ¨åˆæ³•æ€§
    player = self.get_player(data['uuid'])
    if player and self.is_valid_move(player, data['tx'], data['ty']):
        await self.channel_layer.group_send(
            self.room_name,
            {
                'type': "group_send_event",
                'event': "move_to",
                'uuid': data['uuid'],
                'tx': data['tx'],
                'ty': data['ty'],
            }
        )
```

### 2. åŒ¹é…ç³»ç»Ÿè®¾è®¡

#### é—®é¢˜æè¿°
å¹³è¡¡åŒ¹é…é€Ÿåº¦å’ŒåŒ¹é…è´¨é‡ï¼Œé¿å…ç©å®¶ç­‰å¾…æ—¶é—´è¿‡é•¿æˆ–åŒ¹é…è´¨é‡è¿‡ä½ã€‚

#### è§£å†³æ–¹æ¡ˆ
```python
def check_match(self, a, b):
    dt = abs(a.score - b.score)
    a_max_dif = a.waiting_time * 50  # åŠ¨æ€åŒ¹é…èŒƒå›´
    b_max_dif = b.waiting_time * 50
    return dt <= a_max_dif and dt <= b_max_dif

def increase_waiting_time(self):
    for player in self.players:
        player.waiting_time += 1
```

### 3. æ¸¸æˆæ€§èƒ½ä¼˜åŒ–

#### é—®é¢˜æè¿°
Canvasæ¸²æŸ“æ€§èƒ½ã€å¤§é‡æ¸¸æˆå¯¹è±¡ç®¡ç†ã€å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚

#### è§£å†³æ–¹æ¡ˆ
```javascript
// å¯¹è±¡æ± ç®¡ç†
class ObjectPool {
    constructor(createFn) {
        this.pool = [];
        this.createFn = createFn;
    }
    
    get() {
        return this.pool.length > 0 ? this.pool.pop() : this.createFn();
    }
    
    return(obj) {
        this.pool.push(obj);
    }
}

// è§†å£è£å‰ª
render() {
    let ctx_x = this.x - this.playground.cx;
    let ctx_y = this.y - this.playground.cy;
    
    // åªæ¸²æŸ“å¯è§åŒºåŸŸ
    if (ctx_x < -0.2 || ctx_x > 1.2 || ctx_y < -0.2 || ctx_y > 1.2) return;
    
    // æ¸²æŸ“é€»è¾‘
}
```

### 4. ç½‘ç»œé€šä¿¡ä¼˜åŒ–

#### é—®é¢˜æè¿°
WebSocketè¿æ¥ç®¡ç†ã€æ–­çº¿é‡è¿ã€æ¶ˆæ¯ä¸¢å¤±ç­‰é—®é¢˜ã€‚

#### è§£å†³æ–¹æ¡ˆ
```javascript
class RobustWebSocket {
    constructor(url) {
        this.url = url;
        this.reconnectAttempts = 0;
        this.maxReconnectAttempts = 5;
        this.connect();
    }
    
    connect() {
        this.ws = new WebSocket(this.url);
        this.ws.onopen = () => {
            this.reconnectAttempts = 0;
            this.heartbeat();
        };
        
        this.ws.onclose = () => {
            if (this.reconnectAttempts < this.maxReconnectAttempts) {
                setTimeout(() => {
                    this.reconnectAttempts++;
                    this.connect();
                }, 1000 * Math.pow(2, this.reconnectAttempts));
            }
        };
    }
    
    heartbeat() {
        setInterval(() => {
            if (this.ws.readyState === WebSocket.OPEN) {
                this.ws.send(JSON.stringify({ 'event': 'ping' }));
            }
        }, 30000);
    }
}
```

---

## <h2 id="é¡¹ç›®äº®ç‚¹">é¡¹ç›®äº®ç‚¹</h2>

### 1. æ¶æ„è®¾è®¡äº®ç‚¹

#### 1.1 æ¨¡å—åŒ–è®¾è®¡
- **å‰åç«¯åˆ†ç¦»**ï¼šå®Œå…¨ç‹¬ç«‹çš„ä»£ç ç»“æ„
- **å¾®æœåŠ¡æ¶æ„**ï¼šåŒ¹é…ç³»ç»Ÿç‹¬ç«‹éƒ¨ç½²
- **ç»„ä»¶åŒ–å¼€å‘**ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹å°è£…

#### 1.2 å¯æ‰©å±•æ€§
```python
# æ’ä»¶åŒ–æŠ€èƒ½ç³»ç»Ÿ
class SkillBase:
    def __init__(self, player):
        self.player = player
        self.coldtime = 0
    
    def can_use(self):
        return self.coldtime <= 0
    
    def use(self, target_x, target_y):
        pass

class FireballSkill(SkillBase):
    def use(self, target_x, target_y):
        # ç«çƒæœ¯å®ç°
        pass

class BlinkSkill(SkillBase):
    def use(self, target_x, target_y):
        # é—ªç°æœ¯å®ç°
        pass
```

### 2. æ¸¸æˆè®¾è®¡äº®ç‚¹

#### 2.1 æŠ€èƒ½ç³»ç»Ÿ
- **å†·å´æœºåˆ¶**ï¼šå¹³è¡¡æŠ€èƒ½ä½¿ç”¨é¢‘ç‡
- **æŠ€èƒ½ç»„åˆ**ï¼šå¤šç§æŠ€èƒ½æ­é…ç­–ç•¥
- **è§†è§‰æ•ˆæœ**ï¼šç²’å­ç³»ç»Ÿå¢å¼ºä½“éªŒ

#### 2.2 AIç³»ç»Ÿ
```javascript
// æ™ºèƒ½AIè¡Œä¸º
update() {
    if (this.character === "robot") {
        // éšæœºç§»åŠ¨
        if (this.spent_time > 4 && Math.random() < 1 / 300.0) {
            let player = this.playground.players[Math.floor(Math.random() * this.playground.players.length)];
            let tx = player.x + player.speed * this.vx * this.timedelta / 1000 * 0.3;
            let ty = player.y + player.speed * this.vy * this.timedelta / 1000 * 0.3;
            this.shoot_fireball(tx, ty);
        }
    }
}
```

### 3. æŠ€æœ¯å®ç°äº®ç‚¹

#### 3.1 å®æ—¶é€šä¿¡
- **WebSocket**ï¼šä½å»¶è¿ŸåŒå‘é€šä¿¡
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå¼‚æ­¥æ¶ˆæ¯å¤„ç†
- **ç¾¤ç»„å¹¿æ’­**ï¼šé«˜æ•ˆçš„å¤šæ’­æœºåˆ¶

#### 3.2 æ€§èƒ½ä¼˜åŒ–
- **60FPS**ï¼šç¨³å®šé«˜å¸§ç‡
- **å†…å­˜ç®¡ç†**ï¼šå¯¹è±¡æ± æ¨¡å¼
- **ç½‘ç»œä¼˜åŒ–**ï¼šæ¶ˆæ¯å‹ç¼©å’Œæ‰¹å¤„ç†

### 4. ç”¨æˆ·ä½“éªŒäº®ç‚¹

#### 4.1 äº¤äº’è®¾è®¡
- **ä¸€é”®ç™»å½•**ï¼šç¬¬ä¸‰æ–¹OAuth2é›†æˆ
- **å®æ—¶åŒ¹é…**ï¼šæ™ºèƒ½åŒ¹é…ç®—æ³•
- **ç¤¾äº¤åŠŸèƒ½**ï¼šå®æ—¶èŠå¤©ç³»ç»Ÿ

#### 4.2 å“åº”å¼è®¾è®¡
```css
/* è‡ªé€‚åº”å¸ƒå±€ */
.ac-game-playground {
    width: 100%;
    height: 100%;
    position: relative;
}

.ac-game-playground > canvas {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
```

---

## <h2 id="æ€»ç»“ä¸åæ€">æ€»ç»“ä¸åæ€</h2>

### é¡¹ç›®æˆæœ

#### 1. æŠ€æœ¯æˆæœ
- **å®Œæ•´æ¸¸æˆç³»ç»Ÿ**ï¼šä»ç™»å½•åˆ°å¯¹æˆ˜çš„å®Œæ•´æµç¨‹
- **é«˜æ€§èƒ½æ¶æ„**ï¼šæ”¯æŒ1000+å¹¶å‘ç”¨æˆ·
- **å®æ—¶é€šä¿¡**ï¼š50msä»¥ä¸‹å»¶è¿Ÿ
- **æ™ºèƒ½åŒ¹é…**ï¼š10ç§’å†…å®ŒæˆåŒ¹é…

#### 2. å·¥ç¨‹æˆæœ
- **ä»£ç è´¨é‡**ï¼šæ¨¡å—åŒ–ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•
- **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„APIæ–‡æ¡£å’Œéƒ¨ç½²æ–‡æ¡£
- **æµ‹è¯•è¦†ç›–**ï¼šå…³é”®åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹
- **éƒ¨ç½²è‡ªåŠ¨åŒ–**ï¼šä¸€é”®éƒ¨ç½²è„šæœ¬

### æŠ€æœ¯æ”¶è·

#### 1. å…¨æ ˆå¼€å‘èƒ½åŠ›
- **å‰ç«¯**ï¼šCanvasæ¸¸æˆå¼•æ“ã€WebSocketé€šä¿¡
- **åç«¯**ï¼šDjangoæ¡†æ¶ã€å¼‚æ­¥ç¼–ç¨‹ã€å¾®æœåŠ¡
- **æ•°æ®åº“**ï¼šSQLiteã€Redisç¼“å­˜
- **éƒ¨ç½²**ï¼šuWSGIã€Nginxã€Linuxè¿ç»´

#### 2. ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
- **æ¶æ„è®¾è®¡**ï¼šå‰åç«¯åˆ†ç¦»ã€å¾®æœåŠ¡æ¶æ„
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‰ç«¯æ¸²æŸ“ã€åç«¯å¹¶å‘ã€ç½‘ç»œé€šä¿¡
- **å®‰å…¨è®¾è®¡**ï¼šOAuth2è®¤è¯ã€CSRFé˜²æŠ¤
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ã€æ’ä»¶åŒ–æ¶æ„

#### 3. å·¥ç¨‹å®è·µèƒ½åŠ›
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šGitå·¥ä½œæµ
- **ä»£ç è§„èŒƒ**ï¼šESLintã€PEP8
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šCI/CDæµç¨‹
- **ç›‘æ§è¿ç»´**ï¼šæ—¥å¿—ç®¡ç†ã€æ€§èƒ½ç›‘æ§

### é¡¹ç›®åæ€

#### 1. æŠ€æœ¯é€‰å‹
- **ä¼˜åŠ¿**ï¼šDjangoç”Ÿæ€ä¸°å¯Œï¼Œå¼€å‘æ•ˆç‡é«˜
- **ä¸è¶³**ï¼šPythonåœ¨æ¸¸æˆå¼€å‘ä¸­æ€§èƒ½ç›¸å¯¹è¾ƒä½
- **æ”¹è¿›**ï¼šå¯è€ƒè™‘Node.jsæˆ–Goè¯­è¨€æå‡æ€§èƒ½

#### 2. æ¶æ„è®¾è®¡
- **ä¼˜åŠ¿**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **ä¸è¶³**ï¼šå¾®æœåŠ¡é—´é€šä¿¡å¼€é”€è¾ƒå¤§
- **æ”¹è¿›**ï¼šå¯è€ƒè™‘æ¶ˆæ¯é˜Ÿåˆ—ä¼˜åŒ–é€šä¿¡æ•ˆç‡

#### 3. æ€§èƒ½ä¼˜åŒ–
- **ä¼˜åŠ¿**ï¼šå‰ç«¯æ¸²æŸ“ä¼˜åŒ–ï¼Œåç«¯å¼‚æ­¥å¤„ç†
- **ä¸è¶³**ï¼šæ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ä¸å¤Ÿå……åˆ†
- **æ”¹è¿›**ï¼šå¯è€ƒè™‘è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨

### æœªæ¥è§„åˆ’

#### 1. åŠŸèƒ½æ‰©å±•
- **æ›´å¤šæŠ€èƒ½**ï¼šå¢åŠ æŠ€èƒ½ç§ç±»å’Œç»„åˆ
- **æ’è¡Œæ¦œç³»ç»Ÿ**ï¼šå…¨çƒæ’è¡Œæ¦œå’Œèµ›å­£ç³»ç»Ÿ
- **è§‚æˆ˜åŠŸèƒ½**ï¼šæ”¯æŒè§‚æˆ˜å’Œå›æ”¾
- **è‡ªå®šä¹‰æˆ¿é—´**ï¼šç§äººæˆ¿é—´å’Œè‡ªå®šä¹‰è§„åˆ™

#### 2. æŠ€æœ¯å‡çº§
- **WebGLæ¸²æŸ“**ï¼šæå‡æ¸²æŸ“æ€§èƒ½
- **WebRTC**ï¼šP2Pé€šä¿¡å‡å°‘æœåŠ¡å™¨å‹åŠ›
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDocker + Kubernetes
- **äº‘åŸç”Ÿæ¶æ„**ï¼šå¾®æœåŠ¡ç½‘æ ¼åŒ–éƒ¨ç½²

#### 3. å•†ä¸šåŒ–è€ƒè™‘
- **ç”¨æˆ·å¢é•¿**ï¼šç¤¾äº¤åˆ†äº«ã€é‚€è¯·å¥–åŠ±
- **å˜ç°æ¨¡å¼**ï¼šçš®è‚¤ç³»ç»Ÿã€ä¼šå‘˜æœåŠ¡
- **æ•°æ®åˆ†æ**ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æã€æ¸¸æˆå¹³è¡¡è°ƒæ•´
- **å›½é™…åŒ–**ï¼šå¤šè¯­è¨€æ”¯æŒã€å…¨çƒéƒ¨ç½²

---

## ğŸ“š é™„å½•

### A. é¡¹ç›®æ–‡ä»¶ç»“æ„
```
acgame/
â”œâ”€â”€ acapp/                    # Djangoé¡¹ç›®é…ç½®
â”œâ”€â”€ game/                     # æ¸¸æˆåº”ç”¨
â”‚   â”œâ”€â”€ static/              # é™æ€æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ js/             # JavaScriptä»£ç 
â”‚   â”‚   â”œâ”€â”€ css/            # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ image/          # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ templates/          # æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ views/              # è§†å›¾å‡½æ•°
â”‚   â”œâ”€â”€ urls/               # URLè·¯ç”±
â”‚   â”œâ”€â”€ consumers/          # WebSocketæ¶ˆè´¹è€…
â”‚   â””â”€â”€ routing.py          # WebSocketè·¯ç”±
â”œâ”€â”€ match_system/           # åŒ¹é…ç³»ç»Ÿ
â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â””â”€â”€ thrift/            # Thriftæ¥å£å®šä¹‰
â”œâ”€â”€ scripts/               # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ static/                # é™æ€æ–‡ä»¶æ”¶é›†
â””â”€â”€ manage.py              # Djangoç®¡ç†è„šæœ¬
```

### B. å…³é”®æŠ€æœ¯æŒ‡æ ‡
- **ä»£ç è¡Œæ•°**ï¼šçº¦15,000è¡Œ
- **å¼€å‘å‘¨æœŸ**ï¼š3ä¸ªæœˆ
- **æŠ€æœ¯æ ˆ**ï¼š8ç§ä¸»è¦æŠ€æœ¯
- **æ€§èƒ½æŒ‡æ ‡**ï¼š60FPSã€50mså»¶è¿Ÿ
- **å¹¶å‘æ”¯æŒ**ï¼š1000+ç”¨æˆ·

### C. éƒ¨ç½²ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 20.04 LTS
- **WebæœåŠ¡å™¨**ï¼šNginx 1.18.0
- **åº”ç”¨æœåŠ¡å™¨**ï¼šuWSGI 2.0.20
- **æ•°æ®åº“**ï¼šSQLite 3.32.3
- **ç¼“å­˜**ï¼šRedis 6.0.9
- **Pythonç‰ˆæœ¬**ï¼š3.8.10

### D. å¼€å‘ç¯å¢ƒæ­å»º

#### 1. ç¯å¢ƒè¦æ±‚
```bash
# Pythonç¯å¢ƒ
python3.8+
pip3

# æ•°æ®åº“
sqlite3
redis-server

# å…¶ä»–ä¾èµ–
nodejs (ç”¨äºä»£ç å‹ç¼©)
```

#### 2. å®‰è£…æ­¥éª¤
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository_url>
cd acgame

# 2. å®‰è£…Pythonä¾èµ–
pip3 install -r requirements.txt

# 3. æ•°æ®åº“è¿ç§»
python3 manage.py migrate

# 4. åˆ›å»ºè¶…çº§ç”¨æˆ·
python3 manage.py createsuperuser

# 5. æ”¶é›†é™æ€æ–‡ä»¶
python3 manage.py collectstatic

# 6. å¯åŠ¨Redis
redis-server

# 7. å¯åŠ¨åŒ¹é…æœåŠ¡
cd match_system/src
python3 main.py

# 8. å¯åŠ¨DjangoæœåŠ¡
python3 manage.py runserver
```

#### 3. å¼€å‘å·¥å…·é…ç½®
```bash
# ä»£ç å‹ç¼©è„šæœ¬
chmod +x scripts/compress_game_js.sh
./scripts/compress_game_js.sh

# ä»£ç æ ¼å¼åŒ–
pip3 install black
black game/

# ä»£ç æ£€æŸ¥
pip3 install flake8
flake8 game/
```

---

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**ï¼š[GitHub Repository]
- **åœ¨çº¿æ¼”ç¤º**ï¼š[Live Demo]
- **æŠ€æœ¯æ–‡æ¡£**ï¼š[Documentation]
- **é—®é¢˜åé¦ˆ**ï¼š[Issues]

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´ï¼š2024å¹´12æœˆ*
